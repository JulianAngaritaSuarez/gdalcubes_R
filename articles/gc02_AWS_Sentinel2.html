<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="gdalcubes">
<title>2. Data cubes from Sentinel-2 data in the cloud • gdalcubes</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="2. Data cubes from Sentinel-2 data in the cloud">
<meta property="og:description" content="gdalcubes">
<meta property="og:image" content="/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">gdalcubes</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/gc01_MODIS.html">1. Creating data cubes from local MODIS imagery</a>
    <a class="dropdown-item" href="../articles/gc02_AWS_Sentinel2.html">2. Data cubes from Sentinel-2 data in the cloud</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/appelmar/gdalcubes_R/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>2. Data cubes from Sentinel-2 data in the cloud</h1>
                        <h4 data-toc-skip class="author">Marius Appel</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/appelmar/gdalcubes_R/blob/HEAD/vignettes/gc02_AWS_Sentinel2.Rmd" class="external-link"><code>vignettes/gc02_AWS_Sentinel2.Rmd</code></a></small>
      <div class="d-none name"><code>gc02_AWS_Sentinel2.Rmd</code></div>
    </div>

    
    
<p>Many cloud computing providers contain large catalogs of satellite imagery as from the Sentinel-2 satellites. To avoid downloading hundreds of images (and gigabytes) from portals, one can directly run a machine on a cloud platform and run the analysis without any downloads before. Fortunately, this has recently been made much easier and more efficient due to the development and popularity of the <a href="https://www.cogeo.org" class="external-link">cloud-optimized GeoTIFF</a> image format and the <a href="https://stacspec.org" class="external-link">SpatioTemporal Asset Catalog (STAC)</a>.</p>
<p>This vignette will not explain any details the specifications but demonstrate how they can be used in combination with gdalcubes and the <a href="https://cran.r-project.org/package=rstac" class="external-link"><code>rstac</code></a> package. We will use the freely available <a href="https://registry.opendata.aws/sentinel-2-l2a-cogs" class="external-link">Sentinel-2 COG catalog</a> on Amazon Web Services (AWS) and the corresponding STAC-API endpoint at <a href="https://earth-search.aws.element84.com/v0/collections/sentinel-s2-l2a" class="external-link uri">https://earth-search.aws.element84.com/v0/collections/sentinel-s2-l2a</a>.</p>
<p>Notice that this vignette in principle runs anywhere but computations take much longer when not working on an AWS machine in the region of the data catalog (in this case us-west-2).</p>
<div class="section level2">
<h2 id="finding-images-with-rstac">Finding images with <code>rstac</code><a class="anchor" aria-label="anchor" href="#finding-images-with-rstac"></a>
</h2>
<p>As an example, we are interested in cloud-free images of New York City in June, 2021. We can use the NYC administrative polygons that are shipped as example data with the package and use the (<code>sf</code>)[<a href="https://cran.r-project.org/package=sf" class="external-link uri">https://cran.r-project.org/package=sf</a>] package for reading and calculating the bounding box.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span>
<span class="co">## Linking to GEOS 3.10.1, GDAL 3.4.0, PROJ 8.2.0; sf_use_s2() is TRUE</span>
<span class="va">nyc_shape</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"nycd.gpkg"</span>,package <span class="op">=</span> <span class="st">"gdalcubes"</span><span class="op">)</span><span class="op">)</span>

<span class="va">bbox</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">nyc_shape</span><span class="op">)</span> 
<span class="va">bbox</span>
<span class="co">##      xmin      ymin      xmax      ymax </span>
<span class="co">##  563069.9 4483098.0  609761.1 4529895.0</span></code></pre></div>
<p>To ask the STACK endpoints for available images intersecting with our area of interest, we need to provide the bounding box in WGS84 (latitude / longitude) coordinates, which we can calculate with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nyc_shape</span> |&gt;
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="st">"EPSG:4326"</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">bbox_wgs84</span>
<span class="va">bbox_wgs84</span>
<span class="co">##      xmin      ymin      xmax      ymax </span>
<span class="co">## -74.25559  40.49614 -73.70002  40.91500</span></code></pre></div>
<p>Next, we load the <code>rstac</code> package, specify the STAC-API endpoint URL and query all available images for our area and time of interest.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/brazil-data-cube/rstac" class="external-link">rstac</a></span><span class="op">)</span>
<span class="va">s</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rstac/man/stac.html" class="external-link">stac</a></span><span class="op">(</span><span class="st">"https://earth-search.aws.element84.com/v0"</span><span class="op">)</span>
  <span class="va">items</span> <span class="op">=</span> <span class="va">s</span> |&gt;
    <span class="fu"><a href="https://rdrr.io/pkg/rstac/man/stac_search.html" class="external-link">stac_search</a></span><span class="op">(</span>collections <span class="op">=</span> <span class="st">"sentinel-s2-l2a-cogs"</span>,
                bbox <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">bbox_wgs84</span><span class="op">[</span><span class="st">"xmin"</span><span class="op">]</span>,<span class="va">bbox_wgs84</span><span class="op">[</span><span class="st">"ymin"</span><span class="op">]</span>,
                         <span class="va">bbox_wgs84</span><span class="op">[</span><span class="st">"xmax"</span><span class="op">]</span>,<span class="va">bbox_wgs84</span><span class="op">[</span><span class="st">"ymax"</span><span class="op">]</span><span class="op">)</span>, 
                datetime <span class="op">=</span> <span class="st">"2021-06-01/2021-06-30"</span><span class="op">)</span> |&gt;
    <span class="fu"><a href="https://rdrr.io/pkg/rstac/man/request.html" class="external-link">post_request</a></span><span class="op">(</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rdrr.io/pkg/rstac/man/items_functions.html" class="external-link">items_fetch</a></span><span class="op">(</span>progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">items</span><span class="op">$</span><span class="va">features</span><span class="op">)</span>
<span class="co">## [1] 48</span></code></pre></div>
<p>As a result, we get a list with metadata and URLs pointing to 48 images. This list is an index-like object pointing to original images on a AWS S3 bucket and hence somewhat similar to gdalcubes image collections.</p>
</div>
<div class="section level2">
<h2 id="converting-stac-items-to-image-collections">Converting STAC items to image collections<a class="anchor" aria-label="anchor" href="#converting-stac-items-to-image-collections"></a>
</h2>
<p>We can convert the STAC response to a gdalcubes image collections using <code><a href="../reference/stac_image_collection.html">stac_image_collection()</a></code>. This function expects a STAC feature list as input and optionally can apply some filters on metadata and bands. Notice that this operation is much faster than the creation of image collections from local files, because all metadata are already available and no image file must be opened. Below, we create a collection for images with less than 10% cloud cover.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/appelmar/gdalcubes_R" class="external-link">gdalcubes</a></span><span class="op">)</span>
<span class="va">s2_collection</span> <span class="op">=</span> <span class="fu"><a href="../reference/stac_image_collection.html">stac_image_collection</a></span><span class="op">(</span><span class="va">items</span><span class="op">$</span><span class="va">features</span>,  property_filter <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="va">x</span><span class="op">[[</span><span class="st">"eo:cloud_cover"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;</span> <span class="fl">10</span><span class="op">}</span><span class="op">)</span>
<span class="va">s2_collection</span>
<span class="co">## Image collection object, referencing 16 images with 18 bands</span>
<span class="co">## Images:</span>
<span class="co">##                       name      left      top   bottom     right</span>
<span class="co">## 1 S2B_18TWK_20210629_0_L2A -75.00023 40.65085 39.65842 -73.78649</span>
<span class="co">## 2 S2B_18TXK_20210629_0_L2A -73.81752 40.64478 40.55838 -73.78649</span>
<span class="co">## 3 S2B_18TWL_20210629_0_L2A -75.00023 41.55184 40.55671 -73.68381</span>
<span class="co">## 4 S2B_18TXL_20210629_0_L2A -73.81884 41.54559 40.55671 -73.45793</span>
<span class="co">## 5 S2A_18TWK_20210624_0_L2A -75.00023 40.65085 39.65836 -73.77774</span>
<span class="co">## 6 S2A_18TXK_20210624_0_L2A -73.81796 40.64478 40.53306 -73.77774</span>
<span class="co">##              datetime        srs</span>
<span class="co">## 1 2021-06-29T16:02:02 EPSG:32618</span>
<span class="co">## 2 2021-06-29T16:01:52 EPSG:32618</span>
<span class="co">## 3 2021-06-29T16:01:48 EPSG:32618</span>
<span class="co">## 4 2021-06-29T16:01:42 EPSG:32618</span>
<span class="co">## 5 2021-06-24T16:02:02 EPSG:32618</span>
<span class="co">## 6 2021-06-24T16:01:52 EPSG:32618</span>
<span class="co">## [ omitted 10 images ] </span>
<span class="co">## </span>
<span class="co">## Bands:</span>
<span class="co">##            name offset scale unit nodata image_count</span>
<span class="co">## 1           B01      0     1                      16</span>
<span class="co">## 2           B02      0     1                      16</span>
<span class="co">## 3           B03      0     1                      16</span>
<span class="co">## 4           B04      0     1                      16</span>
<span class="co">## 5           B05      0     1                      16</span>
<span class="co">## 6           B06      0     1                      16</span>
<span class="co">## 7           B07      0     1                      16</span>
<span class="co">## 8           B08      0     1                      16</span>
<span class="co">## 9           B09      0     1                      16</span>
<span class="co">## 10          B11      0     1                      16</span>
<span class="co">## 11          B12      0     1                      16</span>
<span class="co">## 12          B8A      0     1                      16</span>
<span class="co">## 13 overview:B02      0     1                      16</span>
<span class="co">## 14 overview:B03      0     1                      16</span>
<span class="co">## 15 overview:B04      0     1                      16</span>
<span class="co">## 16   visual:B02      0     1                      16</span>
<span class="co">## 17   visual:B03      0     1                      16</span>
<span class="co">## 18   visual:B04      0     1                      16</span></code></pre></div>
<p>The collection contains 16 images and all spectral bands plus some RGB preview images. However, the <a href="https://sentinels.copernicus.eu/web/sentinel/technical-guides/sentinel-2-msi/level-2a/algorithm" class="external-link">scene classification layer (SCL)</a> containing pixel-wise information whether a pixel shows a cloud, cloud-shadow, water, or something else, is missing. Although the SCL images are available in the returned STAC list, the response does not include all of the metadata to let gdalcubes recognize it as an image. However, it is possible to explicitly list the names of all bands to be included in the collection by adding the <code>asset_names</code> argument:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">assets</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"B01"</span>,<span class="st">"B02"</span>,<span class="st">"B03"</span>,<span class="st">"B04"</span>,<span class="st">"B05"</span>,<span class="st">"B06"</span>, <span class="st">"B07"</span>,<span class="st">"B08"</span>,<span class="st">"B8A"</span>,<span class="st">"B09"</span>,<span class="st">"B11"</span>,<span class="st">"SCL"</span><span class="op">)</span>
<span class="va">s2_collection</span> <span class="op">=</span> <span class="fu"><a href="../reference/stac_image_collection.html">stac_image_collection</a></span><span class="op">(</span><span class="va">items</span><span class="op">$</span><span class="va">features</span>, asset_names <span class="op">=</span> <span class="va">assets</span>, property_filter <span class="op">=</span>
                                      <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="va">x</span><span class="op">[[</span><span class="st">"eo:cloud_cover"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;</span> <span class="fl">10</span><span class="op">}</span><span class="op">)</span>
<span class="va">s2_collection</span>
<span class="co">## Image collection object, referencing 16 images with 12 bands</span>
<span class="co">## Images:</span>
<span class="co">##                       name      left      top   bottom     right</span>
<span class="co">## 1 S2B_18TWK_20210629_0_L2A -75.00023 40.65085 39.65842 -73.78649</span>
<span class="co">## 2 S2B_18TXK_20210629_0_L2A -73.81752 40.64478 40.55838 -73.78649</span>
<span class="co">## 3 S2B_18TWL_20210629_0_L2A -75.00023 41.55184 40.55671 -73.68381</span>
<span class="co">## 4 S2B_18TXL_20210629_0_L2A -73.81884 41.54559 40.55671 -73.45793</span>
<span class="co">## 5 S2A_18TWK_20210624_0_L2A -75.00023 40.65085 39.65836 -73.77774</span>
<span class="co">## 6 S2A_18TXK_20210624_0_L2A -73.81796 40.64478 40.53306 -73.77774</span>
<span class="co">##              datetime        srs</span>
<span class="co">## 1 2021-06-29T16:02:02 EPSG:32618</span>
<span class="co">## 2 2021-06-29T16:01:52 EPSG:32618</span>
<span class="co">## 3 2021-06-29T16:01:48 EPSG:32618</span>
<span class="co">## 4 2021-06-29T16:01:42 EPSG:32618</span>
<span class="co">## 5 2021-06-24T16:02:02 EPSG:32618</span>
<span class="co">## 6 2021-06-24T16:01:52 EPSG:32618</span>
<span class="co">## [ omitted 10 images ] </span>
<span class="co">## </span>
<span class="co">## Bands:</span>
<span class="co">##    name offset scale unit nodata image_count</span>
<span class="co">## 1   B01      0     1                      16</span>
<span class="co">## 2   B02      0     1                      16</span>
<span class="co">## 3   B03      0     1                      16</span>
<span class="co">## 4   B04      0     1                      16</span>
<span class="co">## 5   B05      0     1                      16</span>
<span class="co">## 6   B06      0     1                      16</span>
<span class="co">## 7   B07      0     1                      16</span>
<span class="co">## 8   B08      0     1                      16</span>
<span class="co">## 9   B09      0     1                      16</span>
<span class="co">## 10  B11      0     1                      16</span>
<span class="co">## 11  B8A      0     1                      16</span>
<span class="co">## 12  SCL      0     1                      16</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="creating-and-processing-data-cubes">Creating and processing data cubes<a class="anchor" aria-label="anchor" href="#creating-and-processing-data-cubes"></a>
</h2>
<p>Having an image collection object, we can now use gdalcubes in the same way as we do with local files. Particularly, we define a data cube view and maybe some additional data cube operations. In the following example, we create a coarse resolution (100m) simple median-composite RGB image from a daily data cube.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/gdalcubes_options.html">gdalcubes_options</a></span><span class="op">(</span>parallel <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>
<span class="va">v</span> <span class="op">=</span> <span class="fu"><a href="../reference/cube_view.html">cube_view</a></span><span class="op">(</span>srs<span class="op">=</span><span class="st">"EPSG:32618"</span>, dx<span class="op">=</span><span class="fl">100</span>, dy<span class="op">=</span><span class="fl">100</span>, dt<span class="op">=</span><span class="st">"P1D"</span>, 
                           aggregation<span class="op">=</span><span class="st">"median"</span>, resampling <span class="op">=</span> <span class="st">"average"</span>,
                           extent<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>t0 <span class="op">=</span> <span class="st">"2021-06-01"</span>, t1 <span class="op">=</span> <span class="st">"2021-06-30"</span>,
                                       left<span class="op">=</span><span class="va">bbox</span><span class="op">[</span><span class="st">"xmin"</span><span class="op">]</span>, right<span class="op">=</span><span class="va">bbox</span><span class="op">[</span><span class="st">"xmax"</span><span class="op">]</span>,
                                       top<span class="op">=</span><span class="va">bbox</span><span class="op">[</span><span class="st">"ymax"</span><span class="op">]</span>, bottom<span class="op">=</span><span class="va">bbox</span><span class="op">[</span><span class="st">"ymin"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="va">v</span>
<span class="co">## A data cube view object</span>
<span class="co">## </span>
<span class="co">## Dimensions:</span>
<span class="co">##                low             high count pixel_size</span>
<span class="co">## t       2021-06-01       2021-06-30    30        P1D</span>
<span class="co">## y 4483096.51932691 4529896.51932691   468        100</span>
<span class="co">## x 563065.499607774 609765.499607774   467        100</span>
<span class="co">## </span>
<span class="co">## SRS: "EPSG:32618"</span>
<span class="co">## Temporal aggregation method: "median"</span>
<span class="co">## Spatial resampling method: "average"</span>

<span class="fu"><a href="../reference/raster_cube.html">raster_cube</a></span><span class="op">(</span><span class="va">s2_collection</span>, <span class="va">v</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="../reference/select_bands.html">select_bands</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"B02"</span>,<span class="st">"B03"</span>,<span class="st">"B04"</span><span class="op">)</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="../reference/reduce_time.html">reduce_time</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"median(B02)"</span>, <span class="st">"median(B03)"</span>, <span class="st">"median(B04)"</span><span class="op">)</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span>rgb <span class="op">=</span> <span class="fl">3</span><span class="op">:</span><span class="fl">1</span>, zlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">2500</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="gc02_AWS_Sentinel2_files/figure-html/unnamed-chunk-6-1.png" width="432" style="display: block; margin: auto;"> Of course, we can “zoom in” to Lower Manhattan simply by changing the <em>data cube view</em>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">v</span> <span class="op">=</span> <span class="fu"><a href="../reference/cube_view.html">cube_view</a></span><span class="op">(</span>srs<span class="op">=</span><span class="st">"EPSG:32618"</span>, dx<span class="op">=</span><span class="fl">10</span>, dy<span class="op">=</span><span class="fl">10</span>, dt<span class="op">=</span><span class="st">"P1D"</span>, 
                           aggregation<span class="op">=</span><span class="st">"median"</span>, resampling <span class="op">=</span> <span class="st">"average"</span>,
                           extent<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>t0 <span class="op">=</span> <span class="st">"2021-06-01"</span>, t1 <span class="op">=</span> <span class="st">"2021-06-30"</span>,
                                       left<span class="op">=</span><span class="fl">582182</span>, right<span class="op">=</span><span class="fl">587019</span>,
                                       top<span class="op">=</span><span class="fl">4508997</span>, bottom<span class="op">=</span><span class="fl">4505883</span><span class="op">)</span><span class="op">)</span>
<span class="va">v</span>
<span class="co">## A data cube view object</span>
<span class="co">## </span>
<span class="co">## Dimensions:</span>
<span class="co">##          low       high count pixel_size</span>
<span class="co">## t 2021-06-01 2021-06-30    30        P1D</span>
<span class="co">## y    4505880    4509000   312         10</span>
<span class="co">## x   582180.5   587020.5   484         10</span>
<span class="co">## </span>
<span class="co">## SRS: "EPSG:32618"</span>
<span class="co">## Temporal aggregation method: "median"</span>
<span class="co">## Spatial resampling method: "average"</span>
<span class="fu"><a href="../reference/raster_cube.html">raster_cube</a></span><span class="op">(</span><span class="va">s2_collection</span>, <span class="va">v</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="../reference/select_bands.html">select_bands</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"B02"</span>,<span class="st">"B03"</span>,<span class="st">"B04"</span><span class="op">)</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="../reference/reduce_time.html">reduce_time</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"median(B02)"</span>, <span class="st">"median(B03)"</span>, <span class="st">"median(B04)"</span><span class="op">)</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span>rgb <span class="op">=</span> <span class="fl">3</span><span class="op">:</span><span class="fl">1</span>, zlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">2500</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="gc02_AWS_Sentinel2_files/figure-html/unnamed-chunk-7-1.png" width="432" style="display: block; margin: auto;"></p>
<p>For more complex examples, you can find a <a href="https://youtu.be/Xlg__2PeTXM?t=3693" class="external-link">tutorial on YouTube</a> and corresponding materials on <a href="https://github.com/appelmar/ogh2021" class="external-link">GitHub</a> how to use gdalcubes in the cloud, presented at the virtual OpenGeoHub Summer School 2021.</p>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>Thanks to STAC, cloud-optimized GeoTIFFs, and GDAL being capable of reading imagery from cloud storage directly, moving to cloud-based analysis workflows without downloading any imagery from portals become a lot easier and more efficient. Whether or not this is the right approach depends a lot on particular applications. In some cases (e.g. when having access to institutional HPC resources while applying very complex models on small areas of interest), it might still be appropriate to download the data once. The <code>gdalcubes</code> package still can help as an interface to downloading analysis-ready data cubes instead of image files from portals.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Marius Appel.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
