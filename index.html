<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Earth Observation Data Cubes from Satellite Image Collections • gdalcubes</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Earth Observation Data Cubes from Satellite Image Collections">
<meta property="og:description" content="Processing collections of Earth observation images as on-demand multispectral, multitemporal raster data cubes. Users
    define cubes by spatiotemporal extent, resolution, and spatial reference system and let gdalcubes automatically apply cropping, reprojection, and 
    resampling using the Geospatial Data Abstraction Library (GDAL). Implemented functions on data cubes include reduction over space and time, 
    applying arithmetic expressions on pixel band values, moving window aggregates over time, filtering by space, time, bands, and predicates on pixel values, 
    exporting data cubes as netCDF or GeoTIFF files, and plotting.  The package implements lazy evaluation and 
    multithreading. All computational parts are implemented in C++, linking to the GDAL, netCDF, CURL, and SQLite libraries. 
    See Appel and Pebesma (2019) &lt;doi:10.3390/data4030092&gt; for further details.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">gdalcubes</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/MODIS.html">1. Processing MODIS data with gdalcubes</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/appelmar/gdalcubes_R/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">

<div id="gdalcubes-" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#gdalcubes-" class="anchor"></a>gdalcubes <img src=".img/logo.svg" align="right" alt="" width="120">
</h1></div>

<p>The R package <code>gdalcubes</code> aims at making analyses of large satellite image collections easier, faster, more intuitive, and more interactive.</p>
<p>The package represents the data as <em>regular raster data cubes</em> with dimensions <code>bands</code>, <code>time</code>, <code>y</code>, and <code>x</code> and hides complexities in the data due to different spatial resolutions,map projections, data formats, and irregular temporal sampling.</p>
</div>
<div id="features" class="section level1">
<h1 class="hasAnchor">
<a href="#features" class="anchor"></a>Features</h1>
<ul>
<li>Read and process multitemporal, multispectral Earth observation image collections as <em>regular raster data cubes</em> by applying on-the-fly reprojection, rescaling, cropping, and resampling.</li>
<li>Work with existing Earth observation imagery on local disks or cloud storage without the need to maintain a 2nd copy of the data.</li>
<li>Apply user-defined R functions on data cubes.</li>
<li>Execute data cube operation chains using parallel processing and lazy evaluation.</li>
</ul>
<p>Among others, the package has been successfully used to process data from the Sentinel-2, Landsat, PlanetScope, MODIS, and Global Precipitation Measurement Earth observation satellites / missions.</p>
</div>
<div id="installation" class="section level1">
<h1 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h1>
<p>Install from CRAN with:</p>
<div class="sourceCode" id="cb1"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"gdalcubes"</span>)</pre></div>
<div id="from-sources" class="section level2">
<h2 class="hasAnchor">
<a href="#from-sources" class="anchor"></a>From sources</h2>
<p>Installation from sources is easiest with</p>
<div class="sourceCode" id="cb2"><pre class="r"><span class="kw pkg">remotes</span><span class="kw ns">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_git.html">install_git</a></span>(<span class="st">"https://github.com/appelmar/gdalcubes_R"</span>)</pre></div>
<p>Please make sure that the <a href="https://git-scm.com/downloads">git command line client</a> is available on your system. Otherwise, the above command might not clone the gdalcubes C++ library as a submodule under src/gdalcubes.</p>
<p>The package builds on the external libraries <a href="https://www.gdal.org">GDAL</a>, <a href="https://www.unidata.ucar.edu/software/netcdf">NetCDF</a>, <a href="https://www.sqlite.org">SQLite</a>, and <a href="https://curl.haxx.se/libcurl">curl</a>.</p>
</div>
<div id="windows" class="section level2">
<h2 class="hasAnchor">
<a href="#windows" class="anchor"></a>Windows</h2>
<p>On Windows, you will need <a href="https://cran.r-project.org/bin/windows/Rtools">Rtools</a>. System libraries are automatically downloaded from <a href="https://github.com/rwinlib">rwinlib</a>.</p>
</div>
<div id="linux" class="section level2">
<h2 class="hasAnchor">
<a href="#linux" class="anchor"></a>Linux</h2>
<p>Please install the system libraries e.g. with the package manager of your Linux distribution. Also make sure that you are using a recent version of GDAL (&gt;2.3.0). On Ubuntu, the following commands install all libraries.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>sudo add<span class="op">-</span>apt<span class="op">-</span>repository ppa<span class="op">:</span>ubuntugis<span class="op">/</span>ppa <span class="op">&amp;&amp;</span><span class="st"> </span>sudo apt<span class="op">-</span>get update</span>
<span id="cb3-2"><a href="#cb3-2"></a>sudo apt<span class="op">-</span>get install libgdal<span class="op">-</span>dev libnetcdf<span class="op">-</span>dev libcurl4<span class="op">-</span>openssl<span class="op">-</span>dev libsqlite3<span class="op">-</span>dev libudunits2<span class="op">-</span>dev</span></code></pre></div>
</div>
<div id="macos" class="section level2">
<h2 class="hasAnchor">
<a href="#macos" class="anchor"></a>MacOS</h2>
<p>Use <a href="https://brew.sh">Homebrew</a> to install system libraries with</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>brew install pkg<span class="op">-</span>config</span>
<span id="cb4-2"><a href="#cb4-2"></a>brew install gdal</span>
<span id="cb4-3"><a href="#cb4-3"></a>brew install netcdf</span>
<span id="cb4-4"><a href="#cb4-4"></a>brew install libgit2</span>
<span id="cb4-5"><a href="#cb4-5"></a>brew install udunits</span>
<span id="cb4-6"><a href="#cb4-6"></a>brew install curl</span>
<span id="cb4-7"><a href="#cb4-7"></a>brew install sqlite</span></code></pre></div>
</div>
</div>
<div id="getting-started" class="section level1">
<h1 class="hasAnchor">
<a href="#getting-started" class="anchor"></a>Getting started</h1>
<div id="download-example-data" class="section level2">
<h2 class="hasAnchor">
<a href="#download-example-data" class="anchor"></a>Download example data</h2>
<div class="sourceCode" id="cb5"><pre class="r"><span class="kw">if</span> (!<span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.exists</a></span>(<span class="st">"L8_Amazon"</span>)) {
  <span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span>(<span class="st">"https://uni-muenster.sciebo.de/s/e5yUZmYGX0bo4u9/download"</span>, <span class="kw">destfile</span> <span class="kw">=</span> <span class="st">"L8_Amazon.zip"</span>)
  <span class="fu"><a href="https://rdrr.io/r/utils/unzip.html">unzip</a></span>(<span class="st">"L8_Amazon.zip"</span>, <span class="kw">exdir</span> <span class="kw">=</span> <span class="st">"L8_Amazon"</span>)
}</pre></div>
</div>
<div id="creating-an-image-collection" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-an-image-collection" class="anchor"></a>Creating an image collection</h2>
<p>At first, we must scan all available images once, and extract some metadata such as their spatial extent and acquisition time. The resulting <em>image collection</em> is stored on disk, and typically consumes a few kilobytes per image. Due to the diverse structure of satellite image products, the rules how to derive the required metadata are formalized as <em>collection_formats</em>. The package comes with predefined formats for some Sentinel, Landsat, and MODIS products (see <code><a href="reference/collection_formats.html">collection_formats()</a></code> to print a list of available formats).</p>
<div class="sourceCode" id="cb6"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">gdalcubes</span>)

<span class="fu"><a href="reference/gdalcubes_options.html">gdalcubes_options</a></span>(<span class="kw">threads</span><span class="kw">=</span><span class="fl">8</span>)

<span class="no">files</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span>(<span class="st">"L8_Amazon"</span>, <span class="kw">recursive</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                   <span class="kw">full.names</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">pattern</span> <span class="kw">=</span> <span class="st">".tif"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">files</span>)</pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co">## [1] 1800</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/file.info.html">file.size</a></span>(<span class="no">files</span>)) / <span class="fl">1024</span>^<span class="fl">2</span> <span class="co"># MiB</span></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co">## [1] 1919.118</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="r"><span class="no">L8.col</span> <span class="kw">=</span> <span class="fu"><a href="reference/create_image_collection.html">create_image_collection</a></span>(<span class="no">files</span>, <span class="kw">format</span> <span class="kw">=</span> <span class="st">"L8_SR"</span>, <span class="kw">out_file</span> <span class="kw">=</span> <span class="st">"L8.db"</span>)</pre></div>
</div>
<div id="creating-data-cubes" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-data-cubes" class="anchor"></a>Creating data cubes</h2>
<p>To create a regular raster data cube from the image collection, we define the geometry of our target cube as a <em>data cube view</em>, using the <code><a href="reference/cube_view.html">cube_view()</a></code> function. We define a simple overview, covering the full spatiotemporal extent of the imagery at 1km x 1km pixel size where one data cube cell represents a duration of one year. The provided resampling and aggregation methods are used to spatially reproject, crop, and rescale individual images and combine pixel values from many images within one year respectively. The <code><a href="reference/raster_cube.html">raster_cube()</a></code> function returns a <em>proxy</em> object, i.e., it returns immediately without doing any expensive computations.</p>
<div class="sourceCode" id="cb11"><pre class="r"><span class="no">v.overview</span> <span class="kw">=</span> <span class="fu"><a href="reference/cube_view.html">cube_view</a></span>(<span class="kw">extent</span><span class="kw">=</span><span class="no">L8.col</span>, <span class="kw">dt</span><span class="kw">=</span><span class="st">"P1Y"</span>, <span class="kw">dx</span><span class="kw">=</span><span class="fl">1000</span>, <span class="kw">dy</span><span class="kw">=</span><span class="fl">1000</span>, <span class="kw">srs</span><span class="kw">=</span><span class="st">"EPSG:3857"</span>,
                      <span class="kw">aggregation</span> <span class="kw">=</span> <span class="st">"median"</span>, <span class="kw">resampling</span> <span class="kw">=</span> <span class="st">"bilinear"</span>)
<span class="fu"><a href="reference/raster_cube.html">raster_cube</a></span>(<span class="no">L8.col</span>, <span class="no">v.overview</span>)</pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co">## A GDAL data cube proxy object</span></span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="co">## </span></span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="co">## Dimensions:</span></span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="co">##                 low              high count pixel_size chunk_size</span></span>
<span id="cb12-5"><a href="#cb12-5"></a><span class="co">## t              2013              2019     7        P1Y          1</span></span>
<span id="cb12-6"><a href="#cb12-6"></a><span class="co">## y -764014.387686915 -205014.387686915   559       1000        256</span></span>
<span id="cb12-7"><a href="#cb12-7"></a><span class="co">## x -6582280.06164712 -5799280.06164712   783       1000        256</span></span>
<span id="cb12-8"><a href="#cb12-8"></a><span class="co">## </span></span>
<span id="cb12-9"><a href="#cb12-9"></a><span class="co">## Bands:</span></span>
<span id="cb12-10"><a href="#cb12-10"></a><span class="co">##         name offset scale nodata unit</span></span>
<span id="cb12-11"><a href="#cb12-11"></a><span class="co">## 1    AEROSOL      0     1    NaN     </span></span>
<span id="cb12-12"><a href="#cb12-12"></a><span class="co">## 2        B01      0     1    NaN     </span></span>
<span id="cb12-13"><a href="#cb12-13"></a><span class="co">## 3        B02      0     1    NaN     </span></span>
<span id="cb12-14"><a href="#cb12-14"></a><span class="co">## 4        B03      0     1    NaN     </span></span>
<span id="cb12-15"><a href="#cb12-15"></a><span class="co">## 5        B04      0     1    NaN     </span></span>
<span id="cb12-16"><a href="#cb12-16"></a><span class="co">## 6        B05      0     1    NaN     </span></span>
<span id="cb12-17"><a href="#cb12-17"></a><span class="co">## 7        B06      0     1    NaN     </span></span>
<span id="cb12-18"><a href="#cb12-18"></a><span class="co">## 8        B07      0     1    NaN     </span></span>
<span id="cb12-19"><a href="#cb12-19"></a><span class="co">## 9   PIXEL_QA      0     1    NaN     </span></span>
<span id="cb12-20"><a href="#cb12-20"></a><span class="co">## 10 RADSAT_QA      0     1    NaN</span></span></code></pre></div>
</div>
<div id="processing-data-cubes" class="section level2">
<h2 class="hasAnchor">
<a href="#processing-data-cubes" class="anchor"></a>Processing data cubes</h2>
<p>We can apply (and chain) operations on data cubes:</p>
<div class="sourceCode" id="cb13"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">magrittr</span>)) <span class="co"># for %&gt;%</span>
<span class="no">x</span> <span class="kw">=</span> <span class="fu"><a href="reference/raster_cube.html">raster_cube</a></span>(<span class="no">L8.col</span>, <span class="no">v.overview</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="reference/select_bands.html">select_bands</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"B02"</span>,<span class="st">"B03"</span>,<span class="st">"B04"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="reference/reduce_time.html">reduce_time</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"median(B02)"</span>,<span class="st">"median(B03)"</span>,<span class="st">"median(B04)"</span>))
<span class="no">x</span></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co">## A GDAL data cube proxy object</span></span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="co">## </span></span>
<span id="cb14-3"><a href="#cb14-3"></a><span class="co">## Dimensions:</span></span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="co">##                 low              high count pixel_size chunk_size</span></span>
<span id="cb14-5"><a href="#cb14-5"></a><span class="co">## t              2013              2013     1        P7Y          1</span></span>
<span id="cb14-6"><a href="#cb14-6"></a><span class="co">## y -764014.387686915 -205014.387686915   559       1000        256</span></span>
<span id="cb14-7"><a href="#cb14-7"></a><span class="co">## x -6582280.06164712 -5799280.06164712   783       1000        256</span></span>
<span id="cb14-8"><a href="#cb14-8"></a><span class="co">## </span></span>
<span id="cb14-9"><a href="#cb14-9"></a><span class="co">## Bands:</span></span>
<span id="cb14-10"><a href="#cb14-10"></a><span class="co">##         name offset scale nodata unit</span></span>
<span id="cb14-11"><a href="#cb14-11"></a><span class="co">## 1 B02_median      0     1    NaN     </span></span>
<span id="cb14-12"><a href="#cb14-12"></a><span class="co">## 2 B03_median      0     1    NaN     </span></span>
<span id="cb14-13"><a href="#cb14-13"></a><span class="co">## 3 B04_median      0     1    NaN</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">x</span>, <span class="kw">rgb</span><span class="kw">=</span><span class="fl">3</span>:<span class="fl">1</span>, <span class="kw">zlim</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">1200</span>))</pre></div>
<p><img src=".img/cubes-1.png"><!-- --></p>
<div class="sourceCode" id="cb16"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">RColorBrewer</span>)
 <span class="fu"><a href="reference/raster_cube.html">raster_cube</a></span>(<span class="no">L8.col</span>, <span class="no">v.overview</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="reference/select_bands.html">select_bands</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"B04"</span>,<span class="st">"B05"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="reference/apply_pixel.html">apply_pixel</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"(B05-B04)/(B05+B04)"</span>), <span class="kw">names</span><span class="kw">=</span><span class="st">"NDVI"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="kw">zlim</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">1</span>),  <span class="kw">nbreaks</span><span class="kw">=</span><span class="fl">10</span>, <span class="kw">col</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span>(<span class="fl">9</span>, <span class="st">"YlGn"</span>), <span class="kw">key.pos</span><span class="kw">=</span><span class="fl">1</span>)</pre></div>
<p><img src=".img/cubes-2.png"><!-- --></p>
<p>Calling data cube operations always returns <em>proxy</em> objects, computations are started lazily when users call e.g. <code><a href="https://rdrr.io/pkg/sf/man/plot.html">plot()</a></code>.</p>
</div>
<div id="animations" class="section level2">
<h2 class="hasAnchor">
<a href="#animations" class="anchor"></a>Animations</h2>
<p>Multitemporal data cubes can be animated (thanks to the <a href="https://cran.r-project.org/web/packages/magick/index.html">magick package</a>):</p>
<div class="sourceCode" id="cb17"><pre class="r"><span class="no">v.subarea.yearly</span> <span class="kw">=</span> <span class="fu"><a href="reference/cube_view.html">cube_view</a></span>(<span class="kw">extent</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">left</span><span class="kw">=</span>-<span class="fl">6180000</span>, <span class="kw">right</span><span class="kw">=</span>-<span class="fl">6080000</span>, <span class="kw">bottom</span><span class="kw">=</span>-<span class="fl">550000</span>, <span class="kw">top</span><span class="kw">=</span>-<span class="fl">450000</span>,
                             <span class="kw">t0</span><span class="kw">=</span><span class="st">"2014-01-01"</span>, <span class="kw">t1</span><span class="kw">=</span><span class="st">"2018-12-31"</span>), <span class="kw">dt</span><span class="kw">=</span><span class="st">"P1Y"</span>, <span class="kw">dx</span><span class="kw">=</span><span class="fl">50</span>, <span class="kw">dy</span><span class="kw">=</span><span class="fl">50</span>,
                             <span class="kw">srs</span><span class="kw">=</span><span class="st">"EPSG:3857"</span>, <span class="kw">aggregation</span> <span class="kw">=</span> <span class="st">"median"</span>, <span class="kw">resampling</span> <span class="kw">=</span> <span class="st">"bilinear"</span>)

<span class="fu"><a href="reference/raster_cube.html">raster_cube</a></span>(<span class="no">L8.col</span>, <span class="no">v.subarea.yearly</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="reference/select_bands.html">select_bands</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"B02"</span>,<span class="st">"B03"</span>,<span class="st">"B04"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="reference/animate.html">animate</a></span>(<span class="kw">rgb</span><span class="kw">=</span><span class="fl">3</span>:<span class="fl">1</span>, <span class="kw">zlim</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">100</span>,<span class="fl">1000</span>))</pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="co">##   format width height colorspace matte filesize density</span></span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="co">## 1    gif   672    480       sRGB FALSE        0   72x72</span></span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="co">## 2    gif   672    480       sRGB  TRUE        0   72x72</span></span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="co">## 3    gif   672    480       sRGB  TRUE        0   72x72</span></span>
<span id="cb18-5"><a href="#cb18-5"></a><span class="co">## 4    gif   672    480       sRGB  TRUE        0   72x72</span></span>
<span id="cb18-6"><a href="#cb18-6"></a><span class="co">## 5    gif   672    480       sRGB  TRUE        0   72x72</span></span></code></pre></div>
<p><img src=".img/animation-2.gif"><!-- --></p>
</div>
<div id="data-cube-export" class="section level2">
<h2 class="hasAnchor">
<a href="#data-cube-export" class="anchor"></a>Data cube export</h2>
<p>Data cubes can be exported as single netCDF files with <code><a href="reference/write_ncdf.html">write_ncdf()</a></code>, or as a collection of (possibly cloud-optimized) GeoTIFF files with <code><a href="reference/write_tif.html">write_tif()</a></code>, where each time slice of the cube yields one GeoTIFF file. Data cubes can also be converted to <code>raster</code> or <code>stars</code>objects:</p>
<div class="sourceCode" id="cb19"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">raster</span>))
<span class="fu"><a href="reference/raster_cube.html">raster_cube</a></span>(<span class="no">L8.col</span>, <span class="no">v.overview</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="reference/select_bands.html">select_bands</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"B04"</span>,<span class="st">"B05"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="reference/apply_pixel.html">apply_pixel</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"(B05-B04)/(B05+B04)"</span>), <span class="kw">names</span><span class="kw">=</span><span class="st">"NDVI"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="reference/write_tif.html">write_tif</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html">stack</a></span>() <span class="kw">-&gt;</span> <span class="no">x</span>
<span class="no">x</span></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="co">## class      : RasterStack </span></span>
<span id="cb20-2"><a href="#cb20-2"></a><span class="co">## dimensions : 559, 783, 437697, 7  (nrow, ncol, ncell, nlayers)</span></span>
<span id="cb20-3"><a href="#cb20-3"></a><span class="co">## resolution : 1000, 1000  (x, y)</span></span>
<span id="cb20-4"><a href="#cb20-4"></a><span class="co">## extent     : -6582280, -5799280, -764014.4, -205014.4  (xmin, xmax, ymin, ymax)</span></span>
<span id="cb20-5"><a href="#cb20-5"></a><span class="co">## crs        : +proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +no_defs </span></span>
<span id="cb20-6"><a href="#cb20-6"></a><span class="co">## names      : cube_22054ca59f3b2013, cube_22054ca59f3b2014, cube_22054ca59f3b2015, cube_22054ca59f3b2016, cube_22054ca59f3b2017, cube_22054ca59f3b2018, cube_22054ca59f3b2019</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">stars</span>))
<span class="fu"><a href="reference/raster_cube.html">raster_cube</a></span>(<span class="no">L8.col</span>, <span class="no">v.overview</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="reference/select_bands.html">select_bands</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"B04"</span>,<span class="st">"B05"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="reference/apply_pixel.html">apply_pixel</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"(B05-B04)/(B05+B04)"</span>), <span class="kw">names</span><span class="kw">=</span><span class="st">"NDVI"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/stars/man/st_as_stars.html">st_as_stars</a></span>() <span class="kw">-&gt;</span> <span class="no">y</span>
<span class="no">y</span></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="co">## stars object with 3 dimensions and 1 attribute</span></span>
<span id="cb22-2"><a href="#cb22-2"></a><span class="co">## attribute(s), summary of first 1e+05 cells:</span></span>
<span id="cb22-3"><a href="#cb22-3"></a><span class="co">##      NDVI       </span></span>
<span id="cb22-4"><a href="#cb22-4"></a><span class="co">##  Min.   :-0.56  </span></span>
<span id="cb22-5"><a href="#cb22-5"></a><span class="co">##  1st Qu.: 0.41  </span></span>
<span id="cb22-6"><a href="#cb22-6"></a><span class="co">##  Median : 0.72  </span></span>
<span id="cb22-7"><a href="#cb22-7"></a><span class="co">##  Mean   : 0.57  </span></span>
<span id="cb22-8"><a href="#cb22-8"></a><span class="co">##  3rd Qu.: 0.85  </span></span>
<span id="cb22-9"><a href="#cb22-9"></a><span class="co">##  Max.   : 0.89  </span></span>
<span id="cb22-10"><a href="#cb22-10"></a><span class="co">##  NA's   :79500  </span></span>
<span id="cb22-11"><a href="#cb22-11"></a><span class="co">## dimension(s):</span></span>
<span id="cb22-12"><a href="#cb22-12"></a><span class="co">##      from  to   offset delta                   refsys point</span></span>
<span id="cb22-13"><a href="#cb22-13"></a><span class="co">## x       1 783 -6582280  1000 WGS 84 / Pseudo-Mercator    NA</span></span>
<span id="cb22-14"><a href="#cb22-14"></a><span class="co">## y       1 559  -205014 -1000 WGS 84 / Pseudo-Mercator    NA</span></span>
<span id="cb22-15"><a href="#cb22-15"></a><span class="co">## time    1   7       NA    NA                  POSIXct FALSE</span></span>
<span id="cb22-16"><a href="#cb22-16"></a><span class="co">##                                                   values    </span></span>
<span id="cb22-17"><a href="#cb22-17"></a><span class="co">## x                                                   NULL [x]</span></span>
<span id="cb22-18"><a href="#cb22-18"></a><span class="co">## y                                                   NULL [y]</span></span>
<span id="cb22-19"><a href="#cb22-19"></a><span class="co">## time [2013-01-01,2014-01-01),...,[2019-01-01,2020-01-01)</span></span></code></pre></div>
<p>To reduce the size of exported data cubes, compression and packing (conversion of doubles to smaller integer types) are supported.</p>
<p>If only specific time slices of a data cube are needed, <code><a href="reference/select_time.html">select_time()</a></code> can be called before plotting / exporting.</p>
<div class="sourceCode" id="cb23"><pre class="r"><span class="fu"><a href="reference/raster_cube.html">raster_cube</a></span>(<span class="no">L8.col</span>, <span class="no">v.overview</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="reference/select_bands.html">select_bands</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"B04"</span>,<span class="st">"B05"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="reference/apply_pixel.html">apply_pixel</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"(B05-B04)/(B05+B04)"</span>), <span class="kw">names</span><span class="kw">=</span><span class="st">"NDVI"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="reference/select_time.html">select_time</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"2015"</span>, <span class="st">"2018"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/stars/man/plot.html">plot</a></span>(<span class="kw">zlim</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">1</span>), <span class="kw">nbreaks</span><span class="kw">=</span><span class="fl">10</span>, <span class="kw">col</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span>(<span class="fl">9</span>, <span class="st">"YlGn"</span>), <span class="kw">key.pos</span><span class="kw">=</span><span class="fl">1</span>)</pre></div>
<p><img src=".img/select_time-1.png"><!-- --></p>
</div>
<div id="user-defined-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#user-defined-functions" class="anchor"></a>User-defined functions</h2>
<p>Users can pass custom R functions to <code><a href="reference/reduce_time.html">reduce_time()</a></code> and <code><a href="reference/apply_pixel.html">apply_pixel()</a></code>. Below, we derive a <em>greenest pixel composite</em> by returning RGB values from pixels with maximum NDVI for all pixel time-series.</p>
<div class="sourceCode" id="cb24"><pre class="r"><span class="no">v.subarea.monthly</span> <span class="kw">=</span> <span class="fu"><a href="reference/cube_view.html">cube_view</a></span>(<span class="kw">view</span> <span class="kw">=</span> <span class="no">v.subarea.yearly</span>, <span class="kw">dt</span><span class="kw">=</span><span class="st">"P1M"</span>, <span class="kw">dx</span> <span class="kw">=</span> <span class="fl">100</span>, <span class="kw">dy</span> <span class="kw">=</span> <span class="fl">100</span>,
                              <span class="kw">extent</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">t0</span><span class="kw">=</span><span class="st">"2015-01"</span>, <span class="kw">t0</span><span class="kw">=</span><span class="st">"2018-12"</span>))
<span class="fu"><a href="reference/raster_cube.html">raster_cube</a></span>(<span class="no">L8.col</span>, <span class="no">v.subarea.monthly</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="reference/select_bands.html">select_bands</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"B02"</span>,<span class="st">"B03"</span>,<span class="st">"B04"</span>,<span class="st">"B05"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="reference/apply_pixel.html">apply_pixel</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"(B05-B04)/(B05+B04)"</span>), <span class="kw">names</span><span class="kw">=</span><span class="st">"NDVI"</span>, <span class="kw">keep_bands</span><span class="kw">=</span><span class="fl">TRUE</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="reference/reduce_time.html">reduce_time</a></span>(<span class="kw">names</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"B02"</span>,<span class="st">"B03"</span>,<span class="st">"B04"</span>), <span class="kw">FUN</span><span class="kw">=</span><span class="kw">function</span>(<span class="no">x</span>) {
    <span class="kw">if</span> (<span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">x</span>[<span class="st">"NDVI"</span>,]))) <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">NA</span>,<span class="fl">3</span>))
    <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span> (<span class="no">x</span>[<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"B02"</span>,<span class="st">"B03"</span>,<span class="st">"B04"</span>), <span class="fu"><a href="https://rdrr.io/pkg/raster/man/which.minmax.html">which.max</a></span>(<span class="no">x</span>[<span class="st">"NDVI"</span>,])])
  }) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/stars/man/plot.html">plot</a></span>(<span class="kw">rgb</span><span class="kw">=</span><span class="fl">3</span>:<span class="fl">1</span>, <span class="kw">zlim</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">100</span>,<span class="fl">1000</span>))</pre></div>
<p><img src=".img/greenest_pixel_composite-1.png"><!-- --></p>
</div>
<div id="extraction-of-pixels-time-series-and-summary-statistics-over-polygons" class="section level2">
<h2 class="hasAnchor">
<a href="#extraction-of-pixels-time-series-and-summary-statistics-over-polygons" class="anchor"></a>Extraction of pixels, time series, and summary statistics over polygons</h2>
<p>In many cases, one is interested in extracting sets of points, time series, or summary statistics over polygons, e.g., to generate training data for machine learning models. Package version 0.3 therefore introduces the functions <code><a href="reference/query_points.html">query_points()</a></code>, <code><a href="reference/query_timeseries.html">query_timeseries()</a></code>, and <code><a href="reference/zonal_statistics.html">zonal_statistics()</a></code>.</p>
<p>Below, we randomly select 10 locations and query values of single data cube cells and complete time series.</p>
<div class="sourceCode" id="cb25"><pre class="r"><span class="no">x</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(<span class="fl">10</span>, <span class="no">v.overview</span>$<span class="no">space</span>$<span class="no">left</span>, <span class="no">v.overview</span>$<span class="no">space</span>$<span class="no">right</span>)
<span class="no">y</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(<span class="fl">10</span>, <span class="no">v.overview</span>$<span class="no">space</span>$<span class="no">bottom</span>, <span class="no">v.overview</span>$<span class="no">space</span>$<span class="no">top</span>)
<span class="no">t</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.character.html">as.character</a></span>(<span class="fl">2013</span>:<span class="fl">2019</span>), <span class="fl">10</span>, <span class="kw">replace</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="fu"><a href="reference/raster_cube.html">raster_cube</a></span>(<span class="no">L8.col</span>, <span class="no">v.overview</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="reference/select_bands.html">select_bands</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"B04"</span>,<span class="st">"B05"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="reference/query_points.html">query_points</a></span>(<span class="no">x</span>,<span class="no">y</span>,<span class="no">t</span>, <span class="no">v.overview</span>$<span class="no">space</span>$<span class="no">srs</span>)</pre></div>
<div class="sourceCode" id="cb26"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="co">##         B04      B05</span></span>
<span id="cb26-2"><a href="#cb26-2"></a><span class="co">## 1  285.1461 3340.956</span></span>
<span id="cb26-3"><a href="#cb26-3"></a><span class="co">## 2       NaN      NaN</span></span>
<span id="cb26-4"><a href="#cb26-4"></a><span class="co">## 3  555.7998 3584.006</span></span>
<span id="cb26-5"><a href="#cb26-5"></a><span class="co">## 4       NaN      NaN</span></span>
<span id="cb26-6"><a href="#cb26-6"></a><span class="co">## 5       NaN      NaN</span></span>
<span id="cb26-7"><a href="#cb26-7"></a><span class="co">## 6  636.7866 2886.451</span></span>
<span id="cb26-8"><a href="#cb26-8"></a><span class="co">## 7       NaN      NaN</span></span>
<span id="cb26-9"><a href="#cb26-9"></a><span class="co">## 8  432.9606 2984.170</span></span>
<span id="cb26-10"><a href="#cb26-10"></a><span class="co">## 9  594.7715 3538.645</span></span>
<span id="cb26-11"><a href="#cb26-11"></a><span class="co">## 10      NaN      NaN</span></span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="r"><span class="fu"><a href="reference/raster_cube.html">raster_cube</a></span>(<span class="no">L8.col</span>, <span class="no">v.overview</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="reference/select_bands.html">select_bands</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"B04"</span>,<span class="st">"B05"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="reference/query_timeseries.html">query_timeseries</a></span>(<span class="no">x</span>, <span class="no">y</span>, <span class="no">v.overview</span>$<span class="no">space</span>$<span class="no">srs</span>)</pre></div>
<div class="sourceCode" id="cb28"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="co">## $B04</span></span>
<span id="cb28-2"><a href="#cb28-2"></a><span class="co">##        2013     2014     2015      2016     2017     2018     2019</span></span>
<span id="cb28-3"><a href="#cb28-3"></a><span class="co">## 1       NaN 285.1461      NaN 3418.5358 305.4599 332.0992 323.7041</span></span>
<span id="cb28-4"><a href="#cb28-4"></a><span class="co">## 2       NaN      NaN      NaN       NaN      NaN      NaN      NaN</span></span>
<span id="cb28-5"><a href="#cb28-5"></a><span class="co">## 3  461.5016 585.7743 555.8947  555.7998 478.8317 593.2361 458.7815</span></span>
<span id="cb28-6"><a href="#cb28-6"></a><span class="co">## 4       NaN 206.4800 231.0744  248.3554 243.5485 190.8519      NaN</span></span>
<span id="cb28-7"><a href="#cb28-7"></a><span class="co">## 5       NaN      NaN      NaN       NaN      NaN      NaN      NaN</span></span>
<span id="cb28-8"><a href="#cb28-8"></a><span class="co">## 6       NaN 276.2733 319.7856 1789.1146 636.7866 735.5462      NaN</span></span>
<span id="cb28-9"><a href="#cb28-9"></a><span class="co">## 7       NaN      NaN      NaN       NaN      NaN      NaN      NaN</span></span>
<span id="cb28-10"><a href="#cb28-10"></a><span class="co">## 8       NaN 212.6797 266.0789  282.9415 432.9606 226.9705      NaN</span></span>
<span id="cb28-11"><a href="#cb28-11"></a><span class="co">## 9  181.8807 207.3071 594.7715  483.4942 214.6374 212.3614 191.6095</span></span>
<span id="cb28-12"><a href="#cb28-12"></a><span class="co">## 10      NaN      NaN      NaN       NaN      NaN      NaN      NaN</span></span>
<span id="cb28-13"><a href="#cb28-13"></a><span class="co">## </span></span>
<span id="cb28-14"><a href="#cb28-14"></a><span class="co">## $B05</span></span>
<span id="cb28-15"><a href="#cb28-15"></a><span class="co">##        2013     2014     2015     2016     2017     2018     2019</span></span>
<span id="cb28-16"><a href="#cb28-16"></a><span class="co">## 1       NaN 3340.956      NaN 4983.803 3249.180 3223.194 3143.337</span></span>
<span id="cb28-17"><a href="#cb28-17"></a><span class="co">## 2       NaN      NaN      NaN      NaN      NaN      NaN      NaN</span></span>
<span id="cb28-18"><a href="#cb28-18"></a><span class="co">## 3  3180.279 3469.603 3431.100 3584.006 3366.193 3782.534 3470.040</span></span>
<span id="cb28-19"><a href="#cb28-19"></a><span class="co">## 4       NaN 3139.709 3095.002 3085.015 3212.694 3051.408      NaN</span></span>
<span id="cb28-20"><a href="#cb28-20"></a><span class="co">## 5       NaN      NaN      NaN      NaN      NaN      NaN      NaN</span></span>
<span id="cb28-21"><a href="#cb28-21"></a><span class="co">## 6       NaN 2936.051 3494.276 3758.901 2886.451 4072.139      NaN</span></span>
<span id="cb28-22"><a href="#cb28-22"></a><span class="co">## 7       NaN      NaN      NaN      NaN      NaN      NaN      NaN</span></span>
<span id="cb28-23"><a href="#cb28-23"></a><span class="co">## 8       NaN 3240.558 3421.281 3254.259 2984.170 3477.211      NaN</span></span>
<span id="cb28-24"><a href="#cb28-24"></a><span class="co">## 9  2894.058 3145.320 3538.645 3200.499 3331.730 2929.747 3009.248</span></span>
<span id="cb28-25"><a href="#cb28-25"></a><span class="co">## 10      NaN      NaN      NaN      NaN      NaN      NaN      NaN</span></span></code></pre></div>
<p>To compute time series of summary statistics over spatial polygons, we need to specify polygon geometries (e.g., as an <code>sf</code> object) and specify one or more statistics that we are interested in, similar as we can do in <code><a href="reference/reduce_time.html">reduce_time()</a></code> or <code><a href="reference/reduce_space.html">reduce_space()</a></code>. In the following, we use the example Landsat dataset (reduced resolution) provided with the package and compute median NDVI within some administrative regions in New York City. The result is a vector data cube in a GeoPackage file that can be further processed and plotted by the <code>stars</code> package.</p>
<div class="sourceCode" id="cb29"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">sf</span>))

<span class="no">L8_files</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"L8NY18"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"gdalcubes"</span>),
                       <span class="st">".TIF"</span>, <span class="kw">recursive</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">full.names</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">v</span> <span class="kw">=</span> <span class="fu"><a href="reference/cube_view.html">cube_view</a></span>(<span class="kw">srs</span><span class="kw">=</span><span class="st">"EPSG:32618"</span>, <span class="kw">dy</span><span class="kw">=</span><span class="fl">300</span>, <span class="kw">dx</span><span class="kw">=</span><span class="fl">300</span>, <span class="kw">dt</span><span class="kw">=</span><span class="st">"P1M"</span>,
              <span class="kw">aggregation</span> <span class="kw">=</span> <span class="st">"median"</span>, <span class="kw">resampling</span> <span class="kw">=</span> <span class="st">"bilinear"</span>,
              <span class="kw">extent</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">left</span><span class="kw">=</span><span class="fl">388941.2</span>, <span class="kw">right</span><span class="kw">=</span><span class="fl">766552.4</span>,
                          <span class="kw">bottom</span><span class="kw">=</span><span class="fl">4345299</span>, <span class="kw">top</span><span class="kw">=</span><span class="fl">4744931</span>,
                          <span class="kw">t0</span><span class="kw">=</span><span class="st">"2018-01-01"</span>, <span class="kw">t1</span><span class="kw">=</span><span class="st">"2018-12-31"</span>))
<span class="fu"><a href="reference/raster_cube.html">raster_cube</a></span>(<span class="fu"><a href="reference/create_image_collection.html">create_image_collection</a></span>(<span class="no">L8_files</span>, <span class="st">"L8_L1TP"</span>), <span class="no">v</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="reference/select_bands.html">select_bands</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"B04"</span>, <span class="st">"B05"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="reference/apply_pixel.html">apply_pixel</a></span>(<span class="st">"(B05-B04)/(B05+B04)"</span>, <span class="st">"NDVI"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="reference/zonal_statistics.html">zonal_statistics</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"nycd.gpkg"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"gdalcubes"</span>),
                  <span class="kw">expr</span> <span class="kw">=</span> <span class="st">"median(NDVI)"</span>, <span class="kw">as_stars</span> <span class="kw">=</span> <span class="fl">TRUE</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/sf/man/plot.html">plot</a></span>(<span class="kw">max.plot</span> <span class="kw">=</span> <span class="fl">12</span>)</pre></div>
<p><img src=".img/zonal_statistics-1.png"><!-- --></p>
<p>Though this is a small toy example only, the implementation works for a large number of polygons and bigger data cubes, too (tested with 50k polygons and approx. 500GB Sentinel-2 imagery at 10m spatial resolution).</p>
</div>
</div>
<div id="more-features" class="section level1">
<h1 class="hasAnchor">
<a href="#more-features" class="anchor"></a>More Features</h1>
<p><strong>Mask bands</strong>: Imagery that comes with existing masks (e.g. general pixel quality measures or cloud masks) can apply masks during the construction of the raster data cube, such that masked values will not contribute to data cube values.</p>
<p><strong>Chunk streaming</strong>: Internally, data cubes are chunked. Users can modify the size of chunks as an argument to the <code><a href="reference/raster_cube.html">raster_cube()</a></code> function. This can be useful for performance tuning, or for applying user-defined R functions independently over all chunks, by using the <code><a href="reference/chunk_apply.html">chunk_apply()</a></code> function.</p>
</div>
<div id="limitations" class="section level1">
<h1 class="hasAnchor">
<a href="#limitations" class="anchor"></a>Limitations</h1>
<ul>
<li>There is no support for vector data cubes (<a href="https://cran.r-project.org/package=stars">stars</a> has vector data cubes).</li>
<li>Data cubes are limited to four dimensions (<a href="https://cran.r-project.org/package=stars">stars</a> has cubes with any number of dimensions).</li>
<li>Some operations such as <code><a href="reference/window_time.html">window_time()</a></code> do not support user-defined functions at the moment.</li>
<li>Images must be orthorectified / regularly gridded, Sentinel-1 or Sentinel-5P products require additional preprocessing.</li>
<li>Using gdalcubes in distributed computing cloud infrastructures is still work in progress.</li>
</ul>
</div>
<div id="further-reading" class="section level1">
<h1 class="hasAnchor">
<a href="#further-reading" class="anchor"></a>Further reading</h1>
<ul>
<li>
<a href="https://appelmar.github.io/opengeohub_summerschool2019/tutorial.html">Tutorial</a> presented at OpenGeoHub Summer School 2019</li>
<li>
<a href="https://www.r-spatial.org/r/2019/07/18/gdalcubes1.html">Blog post</a> on r-spatial.org</li>
<li>
<a href="https://www.mdpi.com/2306-5729/4/3/92">Open access paper</a> in the special issue on Earth observation data cubes of the data journal</li>
<li>Some <a href="https://github.com/appelmar/gdalcubes_docs/blob/master/gdalcubes_overview_slides.pdf">introductory slides</a>
</li>
</ul>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=gdalcubes">https://​cloud.r-project.org/​package=gdalcubes</a>
</li>
<li>Browse source code at <br><a href="https://github.com/appelmar/gdalcubes_R/">https://​github.com/​appelmar/​gdalcubes_R/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/appelmar/gdalcubes_R/issues/">https://​github.com/​appelmar/​gdalcubes_R/​issues/​</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>
<div class="citation">
<h2>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html">Citing gdalcubes</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Marius Appel <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0001-5281-3896" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li><a href="authors.html">All authors...</a></li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://travis-ci.org/appelmar/gdalcubes_R"><img src="https://travis-ci.org/appelmar/gdalcubes_R.svg?branch=master" alt="Build Status"></a></li>
<li><a href="https://ci.appveyor.com/project/appelmar/gdalcubes-r"><img src="https://ci.appveyor.com/api/projects/status/github/appelmar/gdalcubes_R?branch=master&amp;svg=true" alt="AppVeyor build status"></a></li>
<li><a href="https://cran.r-project.org/package=gdalcubes"><img src="https://www.r-pkg.org/badges/version/gdalcubes" alt="CRAN"></a></li>
<li><a href="https://cran.r-project.org/package=gdalcubes"><img src="https://cranlogs.r-pkg.org/badges/grand-total/gdalcubes" alt="Downloads"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Marius Appel.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
